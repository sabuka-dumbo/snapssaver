{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Reel Downloader</title>
    <link rel="stylesheet" href="{% static 'styles.css' %}">

    <style>
        /* Optional local override for animated background */
        .Instagram-div {
            background: linear-gradient(-45deg, #FD1D1D, #833AB4, #405DE6, #FD1D1D);
            background-size: 400% 400%;
            animation: gradientBG 10s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .icon-div:hover .icon {
            transform: scale(1.2);
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body>

    <!-- Header Section -->
    <div class="Instagram-div">
        <div class="container2">
            <button class="my-button1" onclick="window.location.href='/'">Instagram</button>
            <button class="my-button2" onclick="window.location.href='/facebook/'" style="background-color: transparent;">Facebook</button>
            <button class="my-button3" onclick="window.location.href='/tiktok/'" style="background-color: transparent;">TikTok</button>
        </div>

        <h1 class="title">Download Instagram Reels Easily</h1>

        <div class="input">
            <input type="text" id="url-input" placeholder="Paste TikTok video URL here" class="input-field">
            <button class="my-button4" id="download-button">Download</button>
        </div>

        <!-- Ad Placeholder -->
        <div class="ad">
            <h5>Advertisement</h5>
        </div>
    </div>

    <!-- Why Us Section -->
    <div class="why-us">
        <h2>Why Use Our Tool?</h2>
        <div class="features">
            <div class="feature-card">
                <h3>Simple, Fast & Reliable</h3>
                <p>Just paste the link, click download â€” that easy.</p>
            </div>
            <div class="feature-card">
                <h3>Optimized for Speed</h3>
                <p>Our system fetches and delivers your reel within seconds.</p>
            </div>
            <div class="feature-card">
                <h3>100% Secure</h3>
                <p>We do not store your data. Your download is private.</p>
            </div>
        </div>
    </div>

    <!-- How-To Section -->
    <div class="how-to">
        <h2>How to Download Reels</h2>
        <ol>
            <li><strong>Copy the Reel URL</strong><br>From the Instagram app or website.</li>
            <li><strong>Paste it Above</strong><br>Use the input box above and click the clipboard icon if needed.</li>
            <li><strong>Click Download</strong><br>We'll fetch and prepare your video.</li>
            <li><strong>Enjoy Offline</strong><br>Save it to your gallery or computer.</li>
        </ol>
    </div>

    <!-- Supported Platforms Section -->
    <div class="supported">
        <h2>Supported Platforms</h2>
        <div class="supported-buttons">
            <button class="platform-btn">Instagram</button>
            <button class="platform-btn">Facebook</button>
            <button class="platform-btn">TikTok</button>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 All rights reserved. Built for simplicity.</p>
    </footer>

    <!-- JavaScript -->
    <script>
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let cookie of cookies) {
                cookie = cookie.trim();
                if (cookie.startsWith(name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    document.addEventListener('DOMContentLoaded', function () {
        const button = document.getElementById('download-button');
        button.addEventListener('click', function () {
            const urlInput = document.getElementById('url-input').value.trim();

            if (!urlInput) {
                alert("Please enter a valid Instagram Reel URL.");
                return;
            }

            button.textContent = "Downloading...";

            fetch('/download/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: `url=${encodeURIComponent(urlInput)}`
            })
            .then(response => {
                if (!response.ok) throw new Error("Download failed.");
                return response.blob();
            })
            .then(blob => {
                const link = document.createElement('a');
                link.href = window.URL.createObjectURL(blob);
                link.download = "instagram_reel.mp4";
                document.body.appendChild(link);
                link.click();
                link.remove();
                button.textContent = "Download";
            })
            .catch(error => {
                alert('Error: ' + error.message);
                button.textContent = "Download";
            });
        });
    });
</script>
</body>
</html>
